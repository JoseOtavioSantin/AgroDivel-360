<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agro Divel ‚Ä¢ An√°lise de Telemetria</title>
<meta name="theme-color" content="#001439" />
<style>

  .section{
  background:#fff;border-radius:16px;border:1px solid #eef2f7;padding:16px;box-shadow:var(--shadow);
  display:grid;grid-template-columns:1fr 260px;gap:14px;align-items:center;
}
@media (max-width:720px){ .section{grid-template-columns:1fr} }
.section h3{margin:0 0 8px;font-size:16px;color:#0f172a}
.section ul{margin:0;padding-left:18px}
.section li{margin:6px 0;line-height:1.5}
.section .spark img{width:100%;height:auto;border-radius:12px;display:block}

  
  :root{
    --bg:#f5f7fb;
    --card:#ffffff;
    --ink:#111827;
    --muted:#6b7280;
    --brand:#001439;
    --brand-2:#0f2a66;
    --ok:#0ea5e9;
    --shadow:0 10px 30px rgba(0,0,0,.08);
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    color:var(--ink);
    background:
      radial-gradient(800px 400px at 10% -10%, #e8eefc 0, transparent 60%),
      radial-gradient(900px 500px at 110% 10%, #e6f5ff 0, transparent 60%),
      var(--bg);
  }

  .container{max-width:1100px;margin:42px auto;padding:0 18px}

  .header{
    display:flex;align-items:center;gap:14px;margin-bottom:20px
  }
  .logo{
    width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#0060ff,#00b7ff);
    display:grid;place-items:center;color:#fff;font-weight:800;box-shadow:var(--shadow)
  }
  .title h1{font-size:22px;margin:0;color:var(--brand)}
  .title p{margin:2px 0 0;color:var(--muted);font-size:13px}

  .card{
    background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
    padding:22px
  }
  .grid{display:grid;gap:14px}
  @media (min-width:700px){ .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))} }

  label{font-size:13px;color:var(--muted);display:block;margin:2px 2px 6px}
  input[type="text"]{
    width:100%;padding:13px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#f9fafb;
    outline:none;transition:all .15s ease;font-size:14px
  }
  input[type="text"]:focus{border-color:#cbd5e1;box-shadow:0 0 0 4px rgba(59,130,246,.1)}
  .file{
    position:relative;border:1px dashed #cbd5e1;border-radius:12px;background:#f8fafc;
    padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer
  }
  .file input{position:absolute;inset:0;opacity:0;cursor:pointer}
  .file .hint{font-size:13px;color:var(--muted)}
  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  button{
    appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;
    cursor:pointer
  }
  .btn-primary{background:var(--brand);color:#fff}
  .btn-primary:hover{background:var(--brand-2)}
  .btn-ghost{background:#eef2ff;color:var(--brand)}
  .btn-ghost:hover{filter:brightness(.97)}

  .note{margin-top:10px;font-size:12px;color:var(--muted)}

  /* Resultado */
  .report{margin-top:22px;display:none}
  .report-header{
    background:linear-gradient(135deg,#001439, #20386f);
    color:#fff;border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)
  }
  .report-header h2{margin:0 0 6px;font-size:20px}
  .report-header p{margin:0;font-size:13px;opacity:.9}

  .sections{margin-top:16px;display:grid;gap:14px}
  .section{
    background:#fff;border-radius:16px;border:1px solid #eef2f7;padding:16px;box-shadow:var(--shadow)
  }
  .section h3{margin:0 0 8px;font-size:16px;color:#0f172a}
  .section ul{margin:0;padding-left:18px}
  .section li{margin:6px 0;line-height:1.5}
  .chip{
    display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;background:#eef2ff;color:#1e3a8a;margin-right:6px
  }

  .error{margin-top:12px;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:12px;border-radius:12px;display:none}
  .loading{display:none;align-items:center;gap:10px;margin-top:12px;color:#334155}
  .spinner{width:16px;height:16px;border:3px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  .analysis{
    margin-top:16px;background:#fff;border:1px solid #eef2f7;border-radius:16px;padding:16px;box-shadow:var(--shadow)
  }
  .analysis h3{margin:0 0 10px}
  .analysis pre{white-space:pre-wrap;margin:0;font-family:inherit;line-height:1.6;color:#0f172a}

  .footer-actions{
    margin-top:14px;display:flex;gap:10px;flex-wrap:wrap
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">AD</div>
      <div class="title">
        <h1>Agro Divel ‚Ä¢ An√°lise de Telemetria</h1>
        <p>Envie o Excel da opera√ß√£o que eu analiso e monto o relat√≥rio na hora.</p>
      </div>
    </div>

    <div class="card">
      <div class="grid cols-2">
        <div>
          <label for="cliente">Nome do Cliente</label>
          <input type="text" id="cliente" placeholder="Ex.: Jo√£o da Silva" />
        </div>
        <div>
          <label for="modelo">Modelo do Equipamento</label>
          <input type="text" id="modelo" placeholder="Ex.: New Holland T7.175" />
        </div>
      </div>

      <label style="margin-top:12px">Relat√≥rio Excel</label>
      <div class="file" id="fileBox">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M14.5 2H6a2 2 0 0 0-2 2v12.5A3.5 3.5 0 0 0 7.5 20H18a2 2 0 0 0 2-2V7.5L14.5 2Z" stroke="#334155" stroke-width="1.6"/><path d="M14 2v4a2 2 0 0 0 2 2h4" stroke="#334155" stroke-width="1.6"/></svg>
        <div class="hint"><strong>Clique para escolher</strong> ou arraste o arquivo .xlsx aqui</div>
        <input type="file" id="fileInput" name="relatorio" accept=".xlsx" />
      </div>

      <div class="actions">
        <button class="btn-primary" id="btnGerar">Gerar an√°lise</button>
        <button class="btn-ghost" onclick="window.print()">Imprimir / Salvar PDF</button>
      </div>

      <div class="loading" id="loading"><span class="spinner"></span> Processando seu relat√≥rio‚Ä¶</div>
      <div class="error" id="errorBox"></div>
      <p class="note">Dica: deixe os campos de Cliente/Modelo preenchidos para personalizar o cabe√ßalho.</p>
    </div>

    <div class="report" id="report">
      <div class="report-header">
        <h2 id="repTitle">üìä An√°lise do Relat√≥rio de Telemetria</h2>
        <p id="repSub">‚Äî</p>
        <div class="footer-actions">
          <span class="chip" id="chipReg">Registros: ‚Äî</span>
          <span class="chip" id="chipPeriodo">Per√≠odo: ‚Äî</span>
        </div>
      </div>

      <div class="sections" id="sections"></div>

      <div class="analysis">
        <h3>Texto completo</h3>
        <pre id="analysisText">‚Äî</pre>
      </div>
    </div>
  </div>

<script>
  // Se abrir esse HTML fora do projeto (file://), defina a URL p√∫blica do Vercel aqui:
  const API_BASE = ""; // ex.: "https://agrodivel360.vercel.app"
  const $ = (id) => document.getElementById(id);

  // UX: mostra o nome do arquivo selecionado
  const fileBox = $("fileBox");
  const fileInput = $("fileInput");
  fileInput.addEventListener("change", () => {
    const f = fileInput.files[0];
    fileBox.querySelector(".hint").innerHTML = f ? `<strong>${f.name}</strong>` : `<strong>Clique para escolher</strong> ou arraste o arquivo .xlsx aqui`;
  });
  // drag & drop
  ["dragenter","dragover"].forEach(ev => fileBox.addEventListener(ev, e => { e.preventDefault(); fileBox.style.borderColor="#93c5fd"; }));
  ["dragleave","drop"].forEach(ev => fileBox.addEventListener(ev, e => { e.preventDefault(); fileBox.style.borderColor="#cbd5e1"; }));
  fileBox.addEventListener("drop", e => {
    const f = e.dataTransfer.files[0];
    if (f) { fileInput.files = e.dataTransfer.files; fileInput.dispatchEvent(new Event("change")); }
  });

  $("btnGerar").addEventListener("click", gerar);

  async function gerar(){
    const err = $("errorBox"); err.style.display="none"; err.textContent="";
    const loading = $("loading"); loading.style.display="flex";
    $("btnGerar").disabled = true;

    try{
      const cliente = $("cliente").value.trim();
      const modelo  = $("modelo").value.trim();
      const file    = fileInput.files[0];
      if(!file){ throw new Error("Selecione um arquivo .xlsx"); }

      const fd = new FormData();
      fd.append("cliente", cliente);
      fd.append("modelo",  modelo);
      fd.append("relatorio", file);

      const resp = await fetch(API_BASE + "/api/analisar", { method:"POST", body: fd });
      const text = await resp.text();
      if(!resp.ok){ throw new Error(`Falha (${resp.status}): ${text}`); }

      let data;
      try{ data = JSON.parse(text) }catch{ throw new Error("Resposta n√£o √© JSON v√°lido."); }

      renderReport(data);
    }catch(e){
      err.textContent = e.message || "Ocorreu um erro inesperado.";
      err.style.display = "block";
    }finally{
      loading.style.display="none";
      $("btnGerar").disabled = false;
    }
  }

  function renderReport(data){
    $("report").style.display = "block";
    $("repTitle").textContent = `üìä An√°lise do Relat√≥rio de Telemetria ‚Äì ${data?.meta?.modelo || "Equipamento"}`;
    const per = data?.meta?.periodo || {};
    $("repSub").textContent = `Cliente: ${data?.meta?.cliente || "N/D"}`;
    $("chipReg").textContent = `Registros: ${data?.meta?.totalFrames ?? "-"}`;
    $("chipPeriodo").textContent = `Per√≠odo: ${per?.inicio || "N/D"} ‚Üí ${per?.fim || "N/D"}`;

    const host = $("sections");
host.innerHTML = "";
(data.sections || []).forEach(sec => {
  const card = document.createElement("section");
  card.className = "section";

  const body = document.createElement("div");
  const h3 = document.createElement("h3");
  h3.textContent = sec.title || "Se√ß√£o";
  body.appendChild(h3);
  if (sec.bullets?.length){
    const ul = document.createElement("ul");
    sec.bullets.forEach(b => { const li = document.createElement("li"); li.textContent = b; ul.appendChild(li); });
    body.appendChild(ul);
  }
  card.appendChild(body);

  if (sec.spark){
    const spark = document.createElement("div");
    spark.className = "spark";
    const img = document.createElement("img");
    img.src = sec.spark;
    img.alt = "mini gr√°fico";
    spark.appendChild(img);
    card.appendChild(spark);
  } else {
    // mant√©m grid alinhado quando n√£o houver gr√°fico
    const spacer = document.createElement("div");
    spacer.style.display = "none";
    card.appendChild(spacer);
  }

  host.appendChild(card);
});
    
</script>
</body>
</html>


