<!-- ... seu <head> e estilos ... -->
<div class="card">
  <h2>Relat√≥rio de Desempenho (HTML)</h2>
  <div class="row">
    <div>
      <label>Nome do Cliente</label>
      <input type="text" id="cliente" placeholder="Ex.: Jo√£o da Silva" />
    </div>
    <div>
      <label>Modelo do Equipamento</label>
      <input type="text" id="modelo" placeholder="Ex.: New Holland T7.175" />
    </div>
  </div>
  <div style="margin-top:12px">
    <label>Anexar Relat√≥rio Excel</label>
    <input type="file" id="fileInput" name="relatorio" accept=".xlsx" />
  </div>
  <div style="margin-top:12px;display:flex;gap:12px">
    <button onclick="gerar()">Gerar An√°lise</button>
    <button onclick="window.print()">Imprimir / Salvar em PDF</button>
  </div>
</div>

<div id="relatorio" class="report" style="display:none">
  <h2 id="titulo"></h2>
  <p class="muted" id="subtitulo"></p>

  <div id="texto-secoes"></div>

  <h3>Texto completo</h3>
  <div id="analise" style="white-space:pre-wrap; line-height:1.5"></div>
</div>

<script>
async function gerar() {
  const cliente = document.getElementById("cliente").value.trim();
  const modelo  = document.getElementById("modelo").value.trim();
  const file    = document.getElementById("fileInput").files[0];

  if (!file) { alert("Selecione um arquivo .xlsx"); return; }

  const fd = new FormData();
  fd.append("cliente", cliente);
  fd.append("modelo", modelo);
  fd.append("relatorio", file);

  const resp = await fetch("/api/analisar", { method:"POST", body: fd });
  if (!resp.ok) {
    const t = await resp.text().catch(()=> "");
    alert("Falha na an√°lise: " + t);
    return;
  }
  const data = await resp.json();

  document.getElementById("relatorio").style.display = "block";
  document.getElementById("titulo").textContent =
    `üìä An√°lise do Relat√≥rio de Telemetria ‚Äì ${data.meta.modelo || "Equipamento"}`;
  const per = data.meta.periodo;
  document.getElementById("subtitulo").textContent =
    `Cliente: ${data.meta.cliente || "N/D"}  |  Per√≠odo: ${per?.inicio || "N/D"} ‚Üí ${per?.fim || "N/D"}`;

  // Monta as se√ß√µes detalhadas (sempre presentes)
  const host = document.getElementById("texto-secoes");
  host.innerHTML = "";
  const order = ["carga","consumo","deslizamento","velocidade","resumo"];
  order.forEach(key => {
    const sec = data.sections?.[key];
    if (!sec) return;
    const h3 = document.createElement("h3");
    h3.textContent = sec.title || key;
    host.appendChild(h3);
    const ul = document.createElement("ul");
    (sec.bullets || []).forEach(b => {
      const li = document.createElement("li");
      li.textContent = b;
      ul.appendChild(li);
    });
    host.appendChild(ul);
  });

  // Texto completo (se a OpenAI respondeu)
  document.getElementById("analise").textContent =
    data.analysis || "‚Äî";
}
</script>
